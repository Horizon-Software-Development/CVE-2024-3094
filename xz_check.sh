#!/bin/bash
#detect CVE-2024-3094
set -eu
echo "Checking system for CVE-2024-3094 Vulnerability..."
echo "https://nvd.nist.gov/vuln/detail/CVE-2024-3094"
s_path=$(whereis -b sshd | awk '{print $2}')
path=$(ldd "$s_path" 2>/dev/null | grep -o '/.liblzma[^ ]' | head -1)
if [ -z "$path" ]; then
    xz_path=$(whereis -b xz | awk '{print $2}')
    path=$(ldd "$xz_path" 2>/dev/null | grep -o '/.liblzma[^ ]' | head -1)
fi
if [ -z "$path" ]; then
    echo "liblzma not found"
    exit
fi
echo "Checking signature in liblzma..."
if hexdump -ve '1/1 "%.2x"' "$path" | grep -q 'f30f1efa554889f54c89ce5389fb81e7000000804883ec28488954241848894c2410'; then
    echo "Function signature in liblzma: VULNERABLE"
else
    echo "Function signature in liblzma: NOT VULNERABLE"
fi
echo "Checking For XZ Vulnerability..."
xzver=$(xz --version | head -n1 | awk '{print $4}')
if [[ "$xzver" == "5.6.0" || "$xzver" == "5.6.1" ]]; then
    echo "xz version $xzver: VULNERABLE"
else
    echo "xz version $xzver: NOT VULNERABLE"
fi